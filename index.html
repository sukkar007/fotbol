<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cocos Creator Game with Parse</title>
  <!-- Ø¬Ù…ÙŠØ¹ meta tags Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© -->
  <style>
    /* CSS Ù…ÙˆØ¬ÙˆØ¯ */
  </style>
  <link rel="stylesheet" type="text/css" href="style-mobile.5b777.css"/>
  <link rel="icon" href="favicon.4c744.ico"/>
</head>
<body>
  <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="0"></canvas>
  <div id="splash">
    <div class="progress-bar stripes">
      <span style="width: 0%"></span>
    </div>
  </div>
  <div id="LOADING"><div id="RING"></div></div>

<!-- =================== Parse SDK Ø£ÙˆÙ„Ø§Ù‹ =================== -->
<script src="https://cdn.jsdelivr.net/npm/parse@latest/dist/parse.min.js"></script>

<!-- =================== Parse Adapter Ø«Ø§Ù†ÙŠØ§Ù‹ =================== -->
<script src="parse-adapter-cocos.js" charset="utf-8"></script>

<!-- =================== Game API Ø«Ø§Ù„Ø«Ø§Ù‹ =================== -->
<script src="game-api-cocos.js" charset="utf-8"></script>

<!-- =================== Game Settings =================== -->
<script src="src/settings.8c7c5.js" charset="utf-8"></script>

<!-- =================== Game Bootstrap =================== -->
<script src="main.b8da4.js" charset="utf-8"></script>

<!-- =================== Game Initialization =================== -->
<script type="text/javascript">
(function () {
    console.log('ğŸ® [Game] Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©...');

    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ù† URL
    const urlParams = new URLSearchParams(window.location.search);
    const sessionToken = urlParams.get('sessionToken');
    
    console.log('ğŸ” [Game] URL Parameters:', {
        sessionToken: sessionToken ? 'Present' : 'Missing',
        appId: urlParams.get('appId'),
        serverURL: urlParams.get('serverURL')
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Parse
    const parseConfig = {
      appId: urlParams.get('appId') || 'spp111424242ssdsd',
      serverURL: urlParams.get('serverURL') || 'https://parse410.onrender.com/parse',
      sessionToken: sessionToken
    };

    console.log('ğŸ“‹ [Game] Parse Config:', parseConfig);

    // Ø¯Ø§Ù„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    window.initializeParseGame = async function() {
      try {
        console.log('ğŸ® [Game] Starting game initialization...');
        
        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙƒÙˆÙ† Parse Ù…ØªØ§Ø­Ø§Ù‹
        let parseAttempts = 0;
        while (typeof Parse === 'undefined' && parseAttempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          parseAttempts++;
        }
        
        if (typeof Parse === 'undefined') {
          console.error('âŒ [Game] Parse SDK not loaded');
          return;
        }
        
        console.log('âœ… [Game] Parse SDK loaded, initializing adapter...');
        
        // ØªÙ‡ÙŠØ¦Ø© Parse Adapter
        if (typeof window.initParseGameAdapter === 'function') {
          window.parseGameAdapter = window.initParseGameAdapter(parseConfig);
        } else {
          console.error('âŒ [Game] initParseGameAdapter not found');
          return;
        }
        
        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙƒÙˆÙ† Adapter Ø¬Ø§Ù‡Ø²Ø§Ù‹
        let adapterAttempts = 0;
        while ((!window.parseGameAdapter || !window.parseGameAdapter.initialized) && adapterAttempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          adapterAttempts++;
        }
        
        if (!window.parseGameAdapter || !window.parseGameAdapter.initialized) {
          console.error('âŒ [Game] Parse Adapter not initialized');
          return;
        }
        
        console.log('âœ… [Game] Parse Adapter ready, initializing Game API...');
        
        // ØªÙ‡ÙŠØ¦Ø© Game API
        if (typeof window.initGameAPI === 'function' && window.parseGameAdapter) {
          window.gameAPI = window.initGameAPI(window.parseGameAdapter);
          
          // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
          const gameState = await window.gameAPI.initialize();
          console.log('âœ… [Game] Game initialized successfully');
          console.log('ğŸ’° Balance:', gameState.balance);
          
          // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
          document.getElementById('LOADING').style.display = 'none';
        }
        
      } catch (e) {
        console.error('âŒ [Game] Error initializing game:', e);
        document.getElementById('LOADING').innerHTML = 
          '<div style="color: white; text-align: center; padding: 20px;">' +
          'Error: ' + e.message + '</div>';
      }
    };

    // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Cocos Creator
    function loadCocosCreator() {
      var debug = window._CCSettings.debug;
      
      function loadScript(moduleName, cb) {
        function scriptLoaded() {
          document.body.removeChild(domScript);
          domScript.removeEventListener('load', scriptLoaded, false);
          cb && cb();
        }
        var domScript = document.createElement('script');
        domScript.async = true;
        domScript.src = moduleName;
        domScript.addEventListener('load', scriptLoaded, false);
        document.body.appendChild(domScript);
      }

      loadScript(debug ? 'cocos2d-js.js' : 'cocos2d-js-min.33c54.js', function () {
        if (CC_PHYSICS_BUILTIN || CC_PHYSICS_CANNON) {
          loadScript(debug ? 'physics.js' : 'physics-min.js', window.boot);
        } else {
          window.boot();
        }
      });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
    setTimeout(() => {
      window.initializeParseGame().then(() => {
        console.log('âœ… [Game] Parse initialization complete, loading Cocos Creator...');
        loadCocosCreator();
      }).catch(error => {
        console.error('âŒ [Game] Initialization failed:', error);
      });
    }, 1000);

    // open web debugger console
    if (typeof VConsole !== 'undefined') {
        window.vConsole = new VConsole();
    }
})();
</script>
</body>
</html>
